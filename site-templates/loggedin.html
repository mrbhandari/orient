{% extends "base.html" %}
{% load staticfiles %}


{% block content %}
    <script type='text/javascript' src="{% static 'highcharts-4.0.4js/highcharts.js' %}"></script>
    <script type='text/javascript' src="{% static 'highslide-4.1.13/highslide/highslide-full.js' %}"></script>
    <script type='text/javascript' src="http://highcharts.com/highslide/highslide.config.js"></script>
    <link rel="stylesheet" type="text/css" href="http://highcharts.com/highslide/highslide.css"/>
  <div class="container">
  <h2>Hi {{full_name}} you are now logged in!</h2>
  <p>Click <a href="/accounts/logout/">here</a> to logout.</p>
  
  <p>Click <a href="/accounts/profile/">here</a> to edit your profile information</p>
  
  {{ requestdict }}
  <div id = 'graphs'></div>
  
  
  </div>  
    <script type='text/javascript'>
        //function addItem(detailed_events_url) {
        //            console.log(detailed_events_url)
        //            $.post("http://test.com/test.php",{username:'username', password:'pword', item:'item'},        
        //            function(data) {
        //               alert("blue")
        //            });
        //        }
        $(document).ready(function() {
            
            var graph_param = {{graph_num}};
            console.log(graph_param)
            $.getJSON('/ajax/set_post_status_series', function(datacollection) {
                
                
                for (counter = 0; counter < datacollection.length; counter++) {
                    var data = datacollection[counter]
                    var detail_url = encodeURI(data.title.replace(/::/g, "&").replace(/#/g, "%23"))
                    $('#graphs').append(["<h3 class='container'>", data.title, "</h3>",
                                         "<a target='_blank' href='\get_event_details?",
                                         detail_url,
                                         "'>Event Details</a>",
                                         "    <a target='_blank' href='\get_user_details?",
                                         detail_url,
                                         "'>User ID List</a>",].join(''))
                    $('#graphs').append( "<div  id='container" + counter + "' counter='" + counter + "'></div>" )
                    //console.log(data.series[6]);
                    $('#container' + counter).highcharts({
                        chart: {
                            type: 'spline'
                        },
                        title: {
                            text: '',
                            style: {
                            display: 'none'
                        }
                        },
                        counter_no: {
                            value: counter
                        },
                        xAxis: {
                            type: 'linear',
                            labels: {
                                overflow: 'justify'
                            }
                        },
                        yAxis: {
                            title: {
                                text: data.series[graph_param].name
                            },
                            //min: 0,
                            //max: 1,
                            minorGridLineWidth: 0,
                            gridLineWidth: 0,
                            alternateGridColor: null,
                            plotBands: [{ // No correlation
                                from: 0.0,
                                to: 0.1,
                                color: 'rgba(68, 170, 213, 0.1)',
                                label: {
                                    text: 'No correlation',
                                    style: {
                                        color: '#606060'
                                    }
                                }
                            }, { // Weak
                                from: 0.1,
                                to: 0.25,
                                color: 'rgba(0, 0, 0, 0)',
                                label: {
                                    text: 'Weak',
                                    style: {
                                        color: '#606060'
                                    }
                                }
                            }, { // Strong
                                from: 0.25,
                                to: 0.5,
                                color: 'rgba(68, 170, 213, 0.1)',
                                label: {
                                    text: 'Strong',
                                    style: {
                                        color: '#606060'
                                    }
                                }
                            }, { // Very Strong
                                from: 0.5,
                                to: 1,
                                color: 'rgba(0, 0, 0, 0)',
                                label: {
                                    text: 'Very Strong',
                                    style: {
                                        color: '#606060'
                                    }
                                }
                            }]
                        },
                        tooltip: {
                            //valueSuffix: '',
                            shared: true,
                            crosshairs: true,
                        },
                        plotOptions: {
                            spline: {
                                lineWidth: 4,
                                states: {
                                    hover: {
                                        lineWidth: 5
                                    }
                                },
                        allowPointSelect: true,
                                
                        point: {
                            events: {
                                click: function (e) {
                                    
                                    
                                    var target = $( e.target )
                                    var graph_no = target.parent().parent().parent().parent().parent().attr('counter')
                                    console.log(datacollection[graph_no].series)
                                    console.log(datacollection[graph_no].series[5].data[this.category][1])
                                    var tp = datacollection[graph_no].series[1].data[this.category][1]
                                    var fp = datacollection[graph_no].series[2].data[this.category][1]
                                    var tn = datacollection[graph_no].series[3].data[this.category][1]
                                    var fn = datacollection[graph_no].series[4].data[this.category][1]
                                    var mcc = datacollection[graph_no].series[5].data[this.category][1]
                                    console.log(datacollection[graph_no].series[5].data[this.category][1])
                                    var chi_squared = datacollection[graph_no].series[6].data[this.category][1]
                                    var scaled_mcc = mcc *(tp + fp)
                                    var expected_value = 10* tp + -1*fp
                                    var row1 = "<table><tr><td> </td><td>+ (Predicted)</td><td>- (Predicted)</td></tr>"
                                    var row2 = "<tr><td> + (Actual)</td><td>" + tp + "</td><td>"+fn+"</td></tr>"
                                    var row3 = "<tr><td> - (Actual)</td><td>" + fp + "</td><td>"+tn+"</td></tr></table>"
                                    var row4 = "<br>Chi squared: " + chi_squared
                                    var row5 = "<br>MCC: " + mcc
                                    var row6 = "<br>Expected value: " + expected_value
                                    var row7 = "<br>Scaled MCC: " + scaled_mcc
                                    hs.htmlExpand(null, {
                                        headingText: 'Details',
                                        maincontentText:  row1 + row2 + row3 + row4 + row5 + row6 + row7,
                                        width: 300
                                    });
                                }
                            },
                            marker: {
                                    enabled: true
                            },
                        },
                                
                                                                
                                
                            }
                        },
                        series: [data.series[graph_param]],
                        navigation: {
                            menuItemStyle: {
                                fontSize: '10px'
                            }
                        }
                    }); //end highcharts container
                };//end for datacollection loop
            }); //end getJSON
        }); //end document ready
    </script>




  </div>

{% endblock %}